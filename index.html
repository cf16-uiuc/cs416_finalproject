
<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<html>
<body>

<h2>National Park Visitors</h2>

<p> As the COVID-19 pandemic has continued on, many Americans have seen the National Parks as a way to get out without engaging in high risk activity. Many Parks have been seeing a record number of visitors throughout the 2021 summer season, with the Utah National Parks, known as The Big 5, becoming increasingly popular. With that in mind, we'll take a look at how the number of visitors to Utah National Parks have increased from the early 1900s to 2016. From there we'll take a deeper look at how visitors to each individual park has changed from 2013 - 2016. Finally we'll take a deep dive at some specific park that I'll specify when I know what I'm doing for the final visualization.</p>

<button type="button" onclick="lineChart()">1</button>
<button type="button" onclick="barChart('All')">2</button>
<button type="button" onclick="treeMap()">3</button>

<div id="data_viz"></div>

<div style="display:none;" id="viz_buttons">
<button type="button" onclick="barChart('2013')">2013</button>
<button type="button" onclick="barChart('2014')">2014</button>
<button type="button" onclick="barChart('2015')">2015</button>
<button type="button" onclick="barChart('2016')">2016</button>
<button type="button" onclick="barChart('All')">2013-2016</button>
</div>

<!-- Text descriptions for the first visualization -->

<p style="display:none;" id="line_desc1"> In the above line chart we can see the total number of visitors to each of the five Utah National Parks from 1904 to 2016. While our data dates back to 1904, none of the five parks officially became National Parks until 1909, when Zion became a National Park. This resulted in visitation to the parks to nearly triple from 1909 to 1910. Bryce Canyon was added to the National Park system in 1923, Arches in 1929, Capitol Reef in 1937, and finally Canyonlands in 1964. Initially, some of these Parks were National Monuments and were given National Park status at a later time. But being added to the National Park system gave added visibiltiy to these five parks. </p>

<p style="display:none;" id="line_desc2"> As we look at the growth of Utah Park visitation over the years, we can see a steady increase from the late 1950s up until the late 80s. From there the annual number of visitors started to steady a bit before beginning to climb again consistently since 2013.</p> 

<p style="display:none;" id="line_desc3"> As you look at the chart feel free to hover over any point on the line to get a look at the exact number of visitors to the five parks for that year. After that, you can move on to the second chart where we take a bit of a more granular look at the number of visitors to each park. </p>

<!-- Text descriptions for the second visualization -->

<p style="display:none;" id="bar_desc1"> In the above bar chart we have the total number of visitors from 2013-2016. The chart begins looking at the four years in aggregate, but feel free to click through the indivudal years to see how park visitation changed throughout the years. You can also hover over the individual bars to see the total number of visitors for the specified year and what percentage of visitors in Utah that park makes up.</p>

<p style="display:none;" id="bar_desc2"> As you navigate throuhg the four years, you'll begin to notice that while total number of visitors to the parks increases each year, the distribution between the five parks is roughly the same. Zion is by far the most popular of the parks, accounting for roughly 44% of visitors and Canyonlands is the least visited, making up just 8% of Utah National Park visitors. </p>




<script>

function lineChart(){

document.getElementById('viz_buttons').style.display = "none";

document.getElementById('line_desc1').style.display = "block";
document.getElementById('line_desc2').style.display = "block";
document.getElementById('line_desc3').style.display = "block";

document.getElementById('bar_desc1').style.display = "none";
document.getElementById('bar_desc2').style.display = "none";



const formater =  d3.format(',d');

  // set the dimensions and margins of the graph
  var margin = {top: 50, right: 30, bottom: 30, left: 80},
      width = 500 - margin.left - margin.right,
      height = 400 - margin.top - margin.bottom;

  // append the svg object to the body of the page
  var svg = d3.select("#data_viz").html("")
    .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

  //Read the data
  d3.csv("https://raw.githubusercontent.com/cf16-uiuc/cs416_finalproject/main/data/annual_utah_visitors.csv",

    // Now I can use this dataset:
    function(data) {
      // Add X axis --> it is a date format
      var x = d3.scaleLinear()
        .domain([1900, 2020])
        .range([ 0, width ]);
      svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x).tickFormat(d3.format('')));
      // Add Y axis
      var y = d3.scaleLinear()
        .domain( [0, d3.max(data, function(d) { return +d.Visitors }) ])
        .range([ height, 0 ]);
      svg.append("g")
        .call(d3.axisLeft(y));
      // Add the line
      svg.append("path")
        .datum(data)
        .attr("fill", "none")
        .attr("stroke", "#69b3a2")
        .attr("stroke-width", 1.5)
        .attr("d", d3.line()
          .x(function(d) { return x(d.Year) })
          .y(function(d) { return y(d.Visitors) })
          )
          
      var Tooltip = d3.select("#data_viz")
      .append("div")
      .style("opacity", 0)
      .attr("class", "tooltip")
      .style("background-color", "white")
      .style("border", "solid")
      .style("border-width", "2px")
      .style("border-radius", "5px")
      .style("padding", "5px")

      // Three function that change the tooltip when user hover / move / leave a cell
      var mouseover = function(d) {
        Tooltip
          .style("opacity", 1)
      }
      
      var mousemove = function(d) {
        Tooltip
          .html("Total Utah National Park Visitors in "+ d.Year +": " + formater(d.Visitors))
          .style("left", (d3.mouse(this)[0]+70) + "px")
          .style("top", (d3.mouse(this)[1]) + "px")
      }
      
      var mouseleave = function(d) {
        Tooltip
          .style("opacity", 0)
      }
      
      // Add the points
      svg
        .append("g")
        .selectAll("dot")
        .data(data)
        .enter()
        .append("circle")
        .attr("cx", function(d) { return x(d.Year) } )
        .attr("cy", function(d) { return y(d.Visitors) } )
        .attr("r", 2.75)
        .attr("fill", "#69b3a2")
        .on("mouseover", mouseover)
        .on("mousemove", mousemove)
        .on("mouseleave", mouseleave)
  })
  }


function barChart(initVal){

document.getElementById('viz_buttons').style.display = "block";

document.getElementById('line_desc1').style.display = "none";
document.getElementById('line_desc2').style.display = "none";
document.getElementById('line_desc3').style.display = "none";

document.getElementById('bar_desc1').style.display = "block";
document.getElementById('bar_desc2').style.display = "block";


// set the dimensions and margins of the graph
var margin = {top: 30, right: 30, bottom: 70, left: 60},
    width = 460 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#data_viz").html("")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

// Initialize the X axis
var x = d3.scaleBand()
  .range([ 0, width ])
  .padding(0.2);
var xAxis = svg.append("g")
  .attr("transform", "translate(0," + height + ")")
  

// Initialize the Y axis
var y = d3.scaleLinear()
  .range([ height, 0]);
var yAxis = svg.append("g")
  .attr("class", "myYaxis")


// A function that create / update the plot for a given variable:
function update(selectedVar) {

	const formater =  d3.format(',d');
    const percent_formater = d3.format(".0%")

  // Parse the Data
  d3.csv("https://raw.githubusercontent.com/cf16-uiuc/cs416_finalproject/main/data/utah_park_visitors.csv", function(data) {

    // X axis
    x.domain(data.map(function(d) { return d.ParkName
; }))
    xAxis.call(d3.axisBottom(x))

    // Add Y axis
    y.domain([0, d3.max(data, function(d) { return +d[selectedVar] }) ]);
    yAxis.call(d3.axisLeft(y));

    // variable u: map data to existing bars
    var u = svg.selectAll("rect")
      .data(data)
      
    
    var Tooltip = d3.select("#data_viz")
  .append("div")
  .style("opacity", 0)
  .attr("class", "tooltip")
  .style("background-color", "white")
  .style("border", "solid")
  .style("border-width", "2px")
  .style("border-radius", "5px")
  .style("padding", "5px")

  // Three function that change the tooltip when user hover / move / leave a cell
  var mouseover = function(d) {
    Tooltip
      .style("opacity", 1)
  }
  var mousemove = function(d) {
    Tooltip
      .html("Total visitors at "+ d.ParkName +": " + formater(d[selectedVar]) + ". This accounts for " + percent_formater(d[selectedVar]/d3.sum(data, function(d) { return +d[selectedVar] })) + " of the total Utah Park visitors")
      .style("left", (d3.mouse(this)[0]+70) + "px")
      .style("top", (d3.mouse(this)[1]) + "px")
  }
  var mouseleave = function(d) {
    Tooltip
      .style("opacity", 0)
  }    

    // update bars
    u.enter()
      .append("rect")
      .merge(u)
        .attr("x", function(d) { return x(d.ParkName); })
        .attr("y", function(d) { return y(d[selectedVar]); })
        .attr("width", x.bandwidth())
        .attr("height", function(d) { return height - y(d[selectedVar]); })
        .attr("fill", "#69b3a2")
        .on("mouseover", mouseover)
        .on("mousemove", mousemove)
        .on("mouseleave", mouseleave);
        
       
  	})

}

// Initialize plot
update(initVal)

}



function treeMap(){


document.getElementById('viz_buttons').style.display = "none";

document.getElementById('line_desc1').style.display = "none";
document.getElementById('line_desc2').style.display = "none";
document.getElementById('line_desc3').style.display = "none";

document.getElementById('bar_desc1').style.display = "none";
document.getElementById('bar_desc2').style.display = "none";


const formater =  d3.format(',d');

// set the dimensions and margins of the graph
var margin = {top: 10, right: 10, bottom: 10, left: 10},
  width = 445 - margin.left - margin.right,
  height = 445 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#data_viz").html("")
.append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

// Read data
d3.csv('https://raw.githubusercontent.com/cf16-uiuc/cs416_finalproject/main/data/zion_monthly.csv', function(data) {

  // stratify the data: reformatting for d3.js
  var root = d3.stratify()
    .id(function(d) { return d.Month; })   // Name of the entity (column name is name in csv)
    .parentId(function(d) { return d.Parent; })   // Name of the parent (column name is parent in csv)
    (data);
  root.sum(function(d) { return +d.Visits })   // Compute the numeric value for each entity

  // Then d3.treemap computes the position of each element of the hierarchy
  // The coordinates are added to the root object above
  d3.treemap()
    .size([width, height])
    .padding(4)
    (root)
    
    
  var Tooltip = d3.select("#data_viz")
      .append("div")
      .style("opacity", 0)
      .attr("class", "tooltip")
      .style("background-color", "white")
      .style("border", "solid")
      .style("border-width", "2px")
      .style("border-radius", "5px")
      .style("padding", "5px")

      // Three function that change the tooltip when user hover / move / leave a cell
      var mouseover = function(d) {
        Tooltip
          .style("opacity", 1)
      }
      
      var mousemove = function(d) {
        Tooltip
          .html("Total Visitors in "+ d.data.Month +": " + 					formater(d.data.Visits))
          .style("left", (d3.mouse(this)[0]+70) + "px")
          .style("top", (d3.mouse(this)[1]) + "px")
      }
      
      var mouseleave = function(d) {
        Tooltip
          .style("opacity", 0)
      }

console.log(root.leaves())
  // use this information to add rectangles:
  svg
    .selectAll("rect")
    .data(root.leaves())
    .enter()
    .append("rect")
      .attr('x', function (d) { return d.x0; })
      .attr('y', function (d) { return d.y0; })
      .attr('width', function (d) { return d.x1 - d.x0; })
      .attr('height', function (d) { return d.y1 - d.y0; })
      .style("stroke", "black")
      .style("fill", "#69b3a2")
      .on("mouseover", mouseover)
      .on("mousemove", mousemove)
      .on("mouseleave", mouseleave);

  // and to add the text labels
  svg
    .selectAll("text")
    .data(root.leaves())
    .enter()
    .append("text")
      .attr("x", function(d){ return d.x0+10})    // +10 to adjust position (more right)
      .attr("y", function(d){ return d.y0+20})    // +20 to adjust position (lower)
      .text(function(d){ return d.data.Month})
      .attr("font-size", "15px")
      .attr("fill", "white");
      
})
}

</script>

</body>
</html>
